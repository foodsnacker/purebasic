#title = "iRSS"#Version = "0.2.0"Structure RSS_Structure  titel.s  beschreibung.s  link.s  datum.s  guid.s  gelesen.iEndStructureStructure RSS_Eintraege_Structure  List rss.RSS_Structure()  URL.s  titel.s  cnt.iEndStructureGlobal NewList Feeds.RSS_Eintraege_Structure()Global dw, dh, mhDefine Menu,Event,ExitProcedure   Hole_RSS(URL.s)  Define XML, ItemCounter, ItemNode    If ReceiveHTTPFile(URL, GetTemporaryDirectory() + "index.rss")    XML = LoadXML(#PB_Any, GetTemporaryDirectory() + "index.rss")    If XML      ItemCounter = 1      ItemNode = XMLNodeFromPath(RootXMLNode(XML), "rss/channel")      Feeds()\titel = GetXMLNodeText(XMLNodeFromPath(ItemNode, "title"))      Repeat        AddElement(Feeds()\RSS())        ItemNode = XMLNodeFromPath(RootXMLNode(XML), "rss/channel/item[" + Str(ItemCounter) + "]")        If ItemNode = 0          Break        EndIf        ItemCounter  + 1        With Feeds()\RSS()          \Titel = GetXMLNodeText(XMLNodeFromPath(ItemNode, "title"))          \Beschreibung = GetXMLNodeText(XMLNodeFromPath(ItemNode, "description"))          \Link = GetXMLNodeText(XMLNodeFromPath(ItemNode, "link"))          \Datum = GetXMLNodeText(XMLNodeFromPath(ItemNode, "pubDate"))          \guid = GetXMLNodeText(XMLNodeFromPath(ItemNode, "guid"))          \gelesen = 0        EndWith      ForEver      FreeXML(XML)    EndIf;     DeleteFile(GetTemporaryDirectory() + "index.rss")  EndIf  Feeds()\cnt = ItemCounter  Feeds()\Url = UrlEndProcedureProcedure   Init()  UsePNGImageDecoder()    CatchImage(0, ?rssicon)  OpenWindow(0,0,0,0,0,#title,#PB_Window_SizeGadget|#PB_Window_Tool|#PB_Window_SystemMenu) ; direkt mit desktopgröße und versteckt?  AddSysTrayIcon(0,WindowID(0),ImageID(0))    CreateMenu(0,WindowID(0))  MenuItem(#PB_Menu_Quit,"Quit" + Chr(9) + "CMD+Q")  MenuItem(#PB_Menu_About,"About" + Chr(9) + "CMD+I")  MenuItem(#PB_Menu_Preferences,"Preferences" + Chr(9) + "CMD+,")      ExamineDesktops()  mh = 25;MenuHeight()  dw = DesktopWidth(0)  dh = DesktopHeight(0) - 2*mh  EndProcedureProcedure   Mache_Menu()  CreatePopupMenu(1)  MenuItem(0,"Quit" + Chr(9) + "CMD+Q")  MenuItem(1,"About" + Chr(9) + "CMD+I")  MenuItem(2,"Preferences" + Chr(9) + "CMD+,")  MenuBar()  i = 0  ForEach Feeds()    With Feeds()      t$ = \titel      If Len(t$) > 20 : t$ = Left(\titel,20) + " ... " : EndIf      OpenSubMenu(t$)      j = 0      ForEach \rss()        t$ = \rss()\titel        If t$ <> ""          n = i * 100 + 100 + j          MenuItem(n,t$)          SetMenuItemState(0,n,\rss()\gelesen)        EndIf        j + 1      Next      CloseSubMenu()    EndWith    i + 1  Next  DisplayPopupMenu(1,WindowID(0))EndProcedureProcedure.s Finde_Menu(Menu)  i = 0  ForEach Feeds()    With Feeds()      j = 0      ForEach \rss()        If (i * 100 + 100 + j) = Menu          \rss()\gelesen = 1          ProcedureReturn \rss()\link        EndIf        j + 1      Next    EndWith    i + 1  NextEndProcedureProcedure   Zeige_URL(Menu)  url$ = Finde_Menu(Menu)  SetWindowTitle(0,#Title)  If url$ <> "" And FindString(LCase(url$), "http://")    SetWindowTitle(0,url$)    ResizeWindow(0,0,mh,dw,dh)    WebGadget(0,0,0,dw,dh,url$)    HideWindow(0,0)  EndIfEndProcedureInit()AddElement(Feeds())Hole_RSS("https://en.wikipedia.org/w/index.php?title=Special:NewPages&feed=rss")SysTrayIconToolTip(0,Str(Feeds()\cnt))Exit = 0Repeat  Event = WaitWindowEvent()  Select Event    Case #PB_Event_CloseWindow : HideWindow(0,1)    Case #PB_Event_Menu    ;{ Menus      Menu = EventMenu()      Debug menu      Select Menu        Case #PB_Menu_Quit,0 : Exit = 1        Case #PB_Menu_About,1        Case #PB_Menu_Preferences,2        Case 100 To 5000 : Zeige_URL(Menu)      EndSelect      ;}    Case #PB_Event_SysTray      EventTyp = EventType()      Select EventTyp        Case #PB_EventType_LeftClick, #PB_EventType_RightClick : Mache_Menu()      EndSelect  EndSelectUntil Exit = 1DataSection   rssicon:  IncludeBinary "rssicon.png"EndDataSection; IDE Options = PureBasic 6.01 LTS - C Backend (MacOS X - arm64); CursorPosition = 74; FirstLine = 18; Folding = g-; EnableXP; UseIcon = iRSS.icns; Executable = ../../../Desktop/iRSS.app; CompileSourceDirectory